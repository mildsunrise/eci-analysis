# ECI.INI

This is the entry point for ECI's component finding. It also holds the mouth data and pre-defined voices. It can be one of:

 - An INI file, at the path specified by the `ECIINI` environment variable, or by default at `ECI.INI` next to `ECI.DLL`.
 - The registry (TODO: document)

Each section has name `<LanguageId>.<DialectId>` (with LanguageId in 1..10 and DialectId in 0..1) and describes a synth engine. It has the following keys:

 - **`Version`**: unknown (not used by ECI). ABI version? in our analyzed build it's always `6.1`.

 - **`Path`**: absolute path to the synthesizer DLL, typically named `<LangCode>.syn`.

 - **`Path_Rom`** (optional): for CJK, absolute path to the romanizer DLL, typically named `<LangCode>rom.dll`.

 - **`CallbackFlag`**: hex number (`%10x`) with a bitmask specifying supported synthesizer callbacks. The bits we've observed ECI check so far are:

   - bit 0 (0x1): `SynthTextIndexCb`
   - bit 8 (0x100): `SynthWordIndexCb`
   - bit 9 (0x200): `SynthUserIndexCb`

   This is so far consistent with `CallbackFlag` bits being assigned in ascending order of appearence of vtable callback setters, excluding `SynthAudioCb`.

 - **`Phoneme<N>`**: mouth animation data for a phoneme. the number `N` is irrelevant, and the value is a space-separated list of numbers comprised of:
   - **phoneme name** (4 × `%d`): bytes giving a NUL-terminated (ASCIIZ) string with the name of the phoneme to associate mouth data to.
     > The inventory of phoneme symbols is similar but not necessarily identical to the inventory of Symbolic Phonetic Representations (SPR) phoneme symbols. The values are taken directly from the phonemic representation generated by the IBM Text-to-Speech TTS engine, whereas the symbols used in SPRs are normalized versions of these phonemes.
     >
     > In addition to the phoneme symbols defined for SPR input, the symbol ¤ (0xA4) is also used to indicate end of utterance, and is associated with a set of neutral mouth position parameters.
   - unknown (3 × `%hd`): not used in ECI as far as we can see
   - **mouth height** (`%ld`): Height of the mouth and lips. This is a linear range from 0-255, where 0 = minimum height (that is, mouth and lips are closed) and 255 = maximum possible height for the mouth.
   - **mouth width** (`%ld`): Width of the mouth and lips. This is a linear range from 0-255, where 0 = minimum width (that is, the mouth and lips are puckered) and 255 = maximum possible width for the mouth.
   - **mouth upturn** (`%ld`): Extent to which the mouth turns up at the corners, that is, how much it smiles. This is a linear range from 0-255, where 0 = mouth corners turning down, 128 = neutral, and 255 = mouth is fully upturned.
   - **jaw open** (`%ld`): Angle to which the jaw is open. This is a linear range from 0-255, where 0 = fully closed, and 255 = completely open.
   - **teeth upper visible** (`%ld`): Extent to which the upper teeth are visible. This is a linear range from 0-255, where 0 = upper teeth are completely hidden, 128 = only the teeth are visible, and 255 = upper teeth and gums are completely exposed.
   - **teeth lower visible** (`%ld`): Extent to which the lower teeth are visible. This is a linear range from 0-255, where 0 = lower teeth are completely hidden, 128 = only the teeth are visible, and 255 = lower teeth & gums are completely exposed.
   - **tongue position** (`%ld`): Tongue position. This is a linear range from 0-255, where 0 = tongue is completely relaxed, and 255 = tongue is against the upper teeth.
   - **lip tension** (`%ld`): Lip tension. This is a linear range from 0-255, where 0 = lips are completely relaxed, and 255 = lips are very tense.

 - **`Voice<N>`**: voice parameters for pre-defined voice `N`, where `N` can be one of:

   - **1**: Adult Male 1
   - **2**: Adult Female 1
   - **3**: Child 1
   - **4**: Adult Male 2
   - **5**: Adult Male 3
   - **6**: Adult Female 2
   - **7**: Elderly Female 1
   - **8**: Elderly Male 1

   The value is a space-separated list of `%d` specifying, in order: gender, head size, pitch baseline, pitch fluctuation, roughness, breathiness, speed, volume.
   <!-- TODO: units -->

There's also an optional `LanguageIndependent` section that isn't used for anything as far as we can see.
